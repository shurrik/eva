<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="com.yunji.oa.dao.IBackLogDAO">

    <sql id="Base_Column_List">
      id,
	  doc_id docId,
	  subject subject,
	  remark remark,
	  flow_id flowId,
	  flow_name flowName,
	  status status,
	  create_date createDate,
	  update_date updateDate,
	  name_space nameSpace
    </sql>
    
    <sql id="Query_condition">
      <trim prefix="WHERE" prefixOverrides="AND | OR">
              <if test="condition.docId!=null">
			  	AND doc_id Like '%${condition.docId}%'
			  </if>
              <if test="condition.subject!=null">
			  	AND subject Like '%${condition.subject}%'
			  </if>
              <if test="condition.remark!=null">
			  	AND remark Like '%${condition.remark}%'
			  </if>
              <if test="condition.flowId!=null">
			  	AND flow_id Like '%${condition.flowId}%'
			  </if>
              <if test="condition.flowName!=null">
			  	AND flow_name Like '%${condition.flowName}%'
			  </if>
              <if test="condition.status!=null">
			  	AND status Like '%${condition.status}%'
			  </if>
              <if test="condition.createDate!=null">
			  	AND create_date Like '%${condition.createDate}%'
			  </if>
              <if test="condition.updateDate!=null">
			  	AND update_date Like '%${condition.updateDate}%'
			  </if>
              <if test="condition.nameSpace!=null">
			  	AND name_space Like '%${condition.nameSpace}%'
			  </if>
        </trim>
    </sql>
    
    <insert id="insert" parameterType="BackLog">
        INSERT INTO t_oa_backlog (
	        id,
		    doc_id,
		    subject,
		    remark,
		    flow_id,
		    flow_name,
		    status,
		    create_date,
		    update_date,
		    name_space
        ) VALUES (
         	#{id},
       		#{docId},
       		#{subject},
       		#{remark},
       		#{flowId},
       		#{flowName},
       		#{status},
       		sysdate(),
       		sysdate(),
       		#{nameSpace}
        )
    </insert>

    <!-- 更新 -->
   	<update id="update" parameterType="BackLog">
        UPDATE t_oa_backlog
        <trim prefix="SET" suffixOverrides=",">
          <if test="docId!=null">
           doc_id=#{docId},
          </if>
          <if test="subject!=null">
           subject=#{subject},
          </if>
          <if test="remark!=null">
           remark=#{remark},
          </if>
          <if test="flowId!=null">
           flow_id=#{flowId},
          </if>
          <if test="flowName!=null">
           flow_name=#{flowName},
          </if>
          <if test="status!=null">
           status=#{status},
          </if>
          <if test="createDate!=null">
           create_date=#{createDate},
          </if>
          <if test="updateDate!=null">
           update_date=#{updateDate},
          </if>
          <if test="nameSpace!=null">
           name_space=#{nameSpace},
          </if>
        </trim>
        WHERE
        id =#{id}
    </update>

   	<update id="updateMap">
        UPDATE t_oa_backlog
        <trim prefix="SET" suffixOverrides=",">
          <if test="map.docId!=null">        
           doc_id=#{map.docId},
          </if>
          <if test="map.subject!=null">        
           subject=#{map.subject},
          </if>
          <if test="map.remark!=null">        
           remark=#{map.remark},
          </if>
          <if test="map.flowId!=null">        
           flow_id=#{map.flowId},
          </if>
          <if test="map.flowName!=null">        
           flow_name=#{map.flowName},
          </if>
          <if test="map.status!=null">        
           status=#{map.status},
          </if>
          <if test="map.createDate!=null">        
           create_date=#{map.createDate},
          </if>
          <if test="map.updateDate!=null">        
           update_date=#{map.updateDate},
          </if>
          <if test="map.nameSpace!=null">        
           name_space=#{map.nameSpace},
          </if>
        </trim>
        WHERE
       id = #{ map.id }
	</update>


     <insert id="insertMap" >
        INSERT INTO t_oa_backlog (
             	id,
			 	doc_id,
			 	subject,
			 	remark,
			 	flow_id,
			 	flow_name,
			 	status,
			 	create_date,
			 	update_date,
			 	name_space,
        ) VALUES (
              	#{map.id},
		    	#{map.docId},
		    	#{map.subject},
		    	#{map.remark},
		    	#{map.flowId},
		    	#{map.flowName},
		    	#{map.status},
		    	#{map.createDate},
		    	#{map.updateDate},
		    	#{map.nameSpace},
        )
    </insert>


  	<update id="updateNull" parameterType="BackLog">
        UPDATE t_oa_backlog
        <trim prefix="SET" suffixOverrides=","> 
			    doc_id=#{docId},
			    subject=#{subject},
			    remark=#{remark},
			    flow_id=#{flowId},
			    flow_name=#{flowName},
			    status=#{status},
			    create_date=#{createDate},
			    update_date=#{updateDate},
			    name_space=#{nameSpace},
        </trim>
        WHERE
        id =#{id}
    </update>

   	<delete id="deleteById" parameterType="java.lang.Integer">
        DELETE FROM t_oa_backlog
        <trim prefix="WHERE" prefixOverrides="AND | OR">
            AND id=#{id}
        </trim>
    </delete>


 	<delete id="deleteByCondition" parameterType="java.util.Map">
        DELETE FROM  t_oa_backlog 
        <trim prefix="WHERE" prefixOverrides="AND | OR">
            <if test="map.id!=null">
                AND id = #{map.id}
            </if>				        
			<if test="map.docId!=null">
				AND doc_id = #{map.docId}
			</if>				
			<if test="map.subject!=null">
				AND subject = #{map.subject}
			</if>				
			<if test="map.remark!=null">
				AND remark = #{map.remark}
			</if>				
			<if test="map.flowId!=null">
				AND flow_id = #{map.flowId}
			</if>				
			<if test="map.flowName!=null">
				AND flow_name = #{map.flowName}
			</if>				
			<if test="map.status!=null">
				AND status = #{map.status}
			</if>				
			<if test="map.createDate!=null">
				AND create_date = #{map.createDate}
			</if>				
			<if test="map.updateDate!=null">
				AND update_date = #{map.updateDate}
			</if>				
			<if test="map.nameSpace!=null">
				AND name_space = #{map.nameSpace}
			</if>				
        </trim>
    </delete>

    <delete id="deleteByProperty" parameterType="java.util.Map">
        DELETE FROM t_oa_backlog WHERE
        ${property}=#{value}
    </delete>

    <select id="fetch" parameterType="java.lang.Integer" resultType="BackLog">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_oa_backlog
        <trim prefix="WHERE" prefixOverrides="AND | OR">
            AND id =#{id}
        </trim>
    </select>

    <select id="findOne" parameterType="java.util.Map" resultType="BackLog">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_oa_backlog WHERE
        ${property}=#{value} 
        LIMIT 0,1
    </select>

    <select id="findList" parameterType="java.util.Map" resultType="BackLog">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_oa_backlog WHERE
       	${property} =#{value}
    </select>

    <select id="findAll" resultType="BackLog">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_oa_backlog
    </select>

    <select id="queryPage" resultType="BackLog">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_oa_backlog
        <include refid="Query_condition" />    
        <if test="condition.sort != null">
			order by ${condition.sort}
		</if>
        <if test="offset != null">
            limit ${offset}, ${rows}
        </if>
    </select>

    <select id="like" parameterType="java.util.Map" resultType="BackLog">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_oa_backlog
        <trim prefix="WHERE" prefixOverrides="AND | OR">
			<if test="id!=null">
				AND id like '%#{id}%'
			</if>
			<if test="docId!=null">
				AND doc_id Like '%$ {condition.docId}%'
			</if>
			<if test="subject!=null">
				AND subject Like '%$ {condition.subject}%'
			</if>
			<if test="remark!=null">
				AND remark Like '%$ {condition.remark}%'
			</if>
			<if test="flowId!=null">
				AND flow_id Like '%$ {condition.flowId}%'
			</if>
			<if test="flowName!=null">
				AND flow_name Like '%$ {condition.flowName}%'
			</if>
			<if test="status!=null">
				AND status Like '%$ {condition.status}%'
			</if>
			<if test="createDate!=null">
				AND create_date Like '%$ {condition.createDate}%'
			</if>
			<if test="updateDate!=null">
				AND update_date Like '%$ {condition.updateDate}%'
			</if>
			<if test="nameSpace!=null">
				AND name_space Like '%$ {condition.nameSpace}%'
			</if>
        </trim>
    </select>


 	<select id="queryList" parameterType="java.util.Map" resultType="BackLog">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_oa_backlog
        <trim prefix="WHERE" prefixOverrides="AND | OR">
            <if test="map.id!=null">
                AND id = #{map.id}
            </if>
			<if test="map.docId!=null">
				AND doc_id = #{map.docId}
			</if>
			<if test="map.subject!=null">
				AND subject = #{map.subject}
			</if>
			<if test="map.remark!=null">
				AND remark = #{map.remark}
			</if>
			<if test="map.flowId!=null">
				AND flow_id = #{map.flowId}
			</if>
			<if test="map.flowName!=null">
				AND flow_name = #{map.flowName}
			</if>
			<if test="map.status!=null">
				AND status = #{map.status}
			</if>
			<if test="map.createDate!=null">
				AND create_date = #{map.createDate}
			</if>
			<if test="map.updateDate!=null">
				AND update_date = #{map.updateDate}
			</if>
			<if test="map.nameSpace!=null">
				AND name_space = #{map.nameSpace}
			</if>
        </trim>
        ORDER BY ${orderBy} ${sortBy}
    </select>

   	<select id="queryOne" parameterType="java.util.Map" resultType="BackLog">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_oa_backlog
        <trim prefix="WHERE" prefixOverrides="AND | OR">
            <if test="map.id!=null">
                AND id = #{map.id}
            </if>
			<if test="map.docId!=null">
				AND doc_id = #{map.docId}
			</if>
			<if test="map.subject!=null">
				AND subject = #{map.subject}
			</if>
			<if test="map.remark!=null">
				AND remark = #{map.remark}
			</if>
			<if test="map.flowId!=null">
				AND flow_id = #{map.flowId}
			</if>
			<if test="map.flowName!=null">
				AND flow_name = #{map.flowName}
			</if>
			<if test="map.status!=null">
				AND status = #{map.status}
			</if>
			<if test="map.createDate!=null">
				AND create_date = #{map.createDate}
			</if>
			<if test="map.updateDate!=null">
				AND update_date = #{map.updateDate}
			</if>
			<if test="map.nameSpace!=null">
				AND name_space = #{map.nameSpace}
			</if>
        </trim>
        limit 0,1
    </select>

  	<select id="count" resultType="java.lang.Integer">
        SELECT count(id) FROM t_oa_backlog
        <include refid="Query_condition" />
    </select>

	<select id="selectMaxId" resultType="java.lang.Integer">
	    SELECT
	    MAX(id)
	    FROM t_oa_backlog
	</select>
    
  	<select id="countFlow" resultType="java.lang.Integer">
		SELECT count(a.id)
		FROM t_oa_backlog a LEFT JOIN t_oa_flowstep b
		ON a.status = b.before_status
		AND a.`flow_id` = b.`flow_id`
		LEFT JOIN t_oa_flowuser c
		ON b.id = c.step_id
		WHERE c.user_id = #{condition.userId}
	      <if test="condition.docId!=null">
		  	AND a.doc_id Like '%${condition.docId}%'
		  </if>
	      <if test="condition.subject!=null">
		  	AND a.subject Like '%${condition.subject}%'
		  </if>
	      <if test="condition.remark!=null">
		  	AND a.remark Like '%${condition.remark}%'
		  </if>
	      <if test="condition.flowId!=null">
		  	AND a.flow_id Like '%${condition.flowId}%'
		  </if>
	      <if test="condition.flowName!=null">
		  	AND a.flow_name Like '%${condition.flowName}%'
		  </if>
	      <if test="condition.status!=null">
		  	AND a.status Like '%${condition.status}%'
		  </if>
	      <if test="condition.createDate!=null">
		  	AND a.create_date Like '%${condition.createDate}%'
		  </if>
	      <if test="condition.updateDate!=null">
		  	AND a.update_date Like '%${condition.updateDate}%'
		  </if>
	      <if test="condition.nameSpace!=null">
		  	AND a.name_space Like '%${condition.nameSpace}%'
		  </if>
    </select>    
    
    <select id="queryFlowPage" resultType="BackLog">
		SELECT 
	      a.id id,
		  a.doc_id docId,
		  a.subject subject,
		  a.remark remark,
		  a.flow_id flowId,
		  a.flow_name flowName,
		  a.status status,
		  a.create_date createDate,
		  a.update_date updateDate,
		  a.name_space nameSpace		
		FROM t_oa_backlog a LEFT JOIN t_oa_flowstep b
		ON a.status = b.before_status
		AND a.`flow_id` = b.`flow_id`
		LEFT JOIN t_oa_flowuser c
		ON b.id = c.step_id
		WHERE c.user_id = #{condition.userId}
	      <if test="condition.docId!=null">
		  	AND a.doc_id Like '%${condition.docId}%'
		  </if>
	      <if test="condition.subject!=null">
		  	AND a.subject Like '%${condition.subject}%'
		  </if>
	      <if test="condition.remark!=null">
		  	AND a.remark Like '%${condition.remark}%'
		  </if>
	      <if test="condition.flowId!=null">
		  	AND a.flow_id Like '%${condition.flowId}%'
		  </if>
	      <if test="condition.flowName!=null">
		  	AND a.flow_name Like '%${condition.flowName}%'
		  </if>
	      <if test="condition.status!=null">
		  	AND a.status Like '%${condition.status}%'
		  </if>
	      <if test="condition.createDate!=null">
		  	AND a.create_date Like '%${condition.createDate}%'
		  </if>
	      <if test="condition.updateDate!=null">
		  	AND a.update_date Like '%${condition.updateDate}%'
		  </if>
	      <if test="condition.nameSpace!=null">
		  	AND a.name_space Like '%${condition.nameSpace}%'
		  </if>
        <if test="condition.sort != null">
			order by ${condition.sort}
		</if>
        <if test="offset != null">
            limit ${offset}, ${rows}
        </if>		
    </select>    	

</mapper>

